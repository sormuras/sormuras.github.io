# Bach.java - Intro 1 - Greetings!

This blog describes how to let [Bach.java](https://github.com/sormuras/bach) build a modular Java project.

> **TL;DR**
>
> - Create a modular Java project
> - Run `jshell https://sormuras.de/bach-build`
> - Done
>
> Fast-forward to the [Build Modular Java Project with Bach.java](#build-modular-java-project-with-bachjava) section.

The remainder and the majority of the text below is about setting up IntelliJ IDEA for a modular Java project.
In order to not re-invent wheels this blog borrows ideas and replays commands from the [Module System Quick-Start Guide](https://openjdk.java.net/projects/jigsaw/quick-start).
It doesn't hurt to (re-)visit that Guide before reading on.

## Prerequisite

- Install [IntelliJ IDEA](https://www.jetbrains.com/idea)
    > Screenshots for this blog post are taken from IDEA 2020.1.1 (Community Edition).
    An older version should be okay, too.

[//]: <> (../asset/img/bach-intro-1/00-AboutIntellijIDEA2020.png)

## New Java Project

- Click **Create New Project** on the Welcome Screen or via the Main Menu **File**/**New**/**Project...**
- Select **Java** in the new project wizard
- Select from **Project SDK** drop-down menu a Java version equal to **11** or higher
    > In this blog JDK 14.0.1 is used.
    >
    > If you haven't already installed a JDK 11+ on your machine,
    make use of IDEA's excellent **Download JDK...** feature offered in drop-down menu.

![](../asset/img/bach-intro-1/01-NewJavaProjectAndSelectJDK.png)

- Click **Next** to finish this step
- Click **Next** to skip **Create project from template** page

## Enter Basic Project Properties

- Enter `Greetings` as the **Project name**
- Choose a location for the project
    > The last path element should read `Greetings`
- Append `/.idea` to the **Module file location** path
    > Keeping all IDEA-related assets in one place, namely below the `.idea/` directory.

![](../asset/img/bach-intro-1/02-EnterProjectPropertiesAndMoreSettings.png)

- Click **Finish** to close the new project wizard

    > A popup window may appear - click **OK** to let IDEA create the `Greetings/.idea` directory for you.

## Fine-tune Project Settings

- Open **Project Structure** dialog
- Insert `.idea` element path of **Project compiler output** property
    > Why? To keep all IDEA-related assets in one place, here below the `.idea/out` directory.

![](../asset/img/bach-intro-1/03a-ProjectSettings-StoreCompilerOutputInDotIdeaFolder.png)

- Select `src` folder in **Modules**/**Greetings**/**Sources**
- Press `DEL` key
- Click **Delete**

![](../asset/img/bach-intro-1/03b-ProjectSettingsModules-DeleteFolderSrc.png)

- Click **Unmark Source**

![](../asset/img/bach-intro-1/03c-ProjectSettingsModules-UnmarkSource.png)

- Click **Apply** to save the fine-tuning.

## Add IDEA Module `com.greetings`

- Click the **+** button at the top of the **Project Settings**/**Modules** page
- Select **New Module**
- Select **Java** -- should be preselected, don't add additional libraries and frameworks

![](../asset/img/bach-intro-1/04a-AddNewModule.png)

- Click **Next**


- Enter `com.greetings` as **Module name**
- Leave **Content root** as-is
- Replace last element (`com.greetings`) with `.idea` in **Module file location**

![](../asset/img/bach-intro-1/04b-EnterJavaModuleComGreetings.png)

- Click **Finish**
- Repeat deletion of the `src` folder as above and don't forget to unmark it


- Select path `${BASE}/com.greetings` (i.e. **Content Root**) from the Sources overview
- Click/mark as **Sources** as shown below.

![](../asset/img/bach-intro-1/04c-MarkModulesContentRootAsSources.png)

- Click **OK** to close the **Project Structure** dialog

## Add Java Module Descriptor `com.greetings`

- Right-click on the `com.greetings` IDEA module
- Select **New** ▶ **module-info.java**

![](../asset/img/bach-intro-1/05a-NewModuleInfoJavaFile.png)

- IDEA just generated an empty, yet proper Java [Module Declaration](https://docs.oracle.com/javase/specs/jls/se11/html/jls-7.html#jls-7.7) for us!

![](../asset/img/bach-intro-1/05b-ModuleComGreetingsGeneratedForUs.png)

## Add Main Class `com.greetings.Main`

- Right-click on the `com.greetings` IDEA module, agin
- Select **New** ▶ **Java Class**

![](../asset/img/bach-intro-1/06a-NewJavaClass.png)

- Enter the fully qualified class name: `com.greetings.Main`

![](../asset/img/bach-intro-1/06b-EnterFullyQualifiedClassName.png)

- IDEA just generated an empty `Main.java` file and stored in package `com.greetings`.
- Add a main method that prints a greeting to the normal output stream.

![](../asset/img/bach-intro-1/07-GenerateMainMethodAndPrintGreeting.png)

## Run Main Class with IDEA

- Right-click on the `com.greetings` IDEA module
- _Press Play On Tape_ ...
- Select ▶ **Run 'Main.main()'**

![](../asset/img/bach-intro-1/08a-RunMainClass.png)

- Verify that the greeting message is printed and the process finished with exit code 0

![](../asset/img/bach-intro-1/08b-GotGreetingsFromJavaModule.png)

## Build Modular Java Project with Bach.java

Finally...

- Open a **Terminal** session
    > Change to the base directory of the project, if necessary.
- Type `jshell https://sormuras.de/bach-build` and press **Enter**
    > This URL is a copy of the [bach-build.jsh](https://github.com/sormuras/bach/raw/master/src/bach/bach-build.jsh) script.
    That JShell-based script forms the zero-installation feature of Bach.java.
    >
    > Run `jshell -R-Debug https://sormuras.de/bach-build` to see what Bach.java is doing.

![](../asset/img/bach-intro-1/09a-OpenTerminalEnterBachJava.png)

- Wait some seconds to let the zero-installation feature bootstrap `Bach.java` and build the project.

![](../asset/img/bach-intro-1/09b-WatchBachJavaWorkInZeroInstallationMode.png)

- Verify with `.bach/workspace/image/bin/greetings` that the main program is executable
    > of the Greetings project in the generated custom runtime image 

![](../asset/img/bach-intro-1/09c-LaunchGreetingsProgramFromCustomRuntimeImage.png)

- Done.

## Want more?

- Browse the `.bach` folder for generated assets: classes, modules, image, summaries, ...
- A summary of the last build is written to the `.bach/summary.md` file.
- Attach some `/** Javadoc */` comment to `module com.greetings {}` and run `bach-build` again.
- Customize the build by editing the `.bach/src/Build.java` program.

